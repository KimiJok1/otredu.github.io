{"componentChunkName":"component---src-templates-content-template-js","path":"/osa3/validointi_ja_es_lint","result":{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<p>Sovelluksen tietokantaan tallettamalle datan muodolle on usein tarve asettaa joitain ehtoja. Sovelluksemme ei esim. hyväksy muistiinpanoja, joiden sisältö eli <i>content</i> kenttä puuttuu. Muistiinpanon oikeellisuus tallennetaan sen luovassa metodissa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>body\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">.</span>content <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> <span class=\"token string\">'content missing'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Eli jos muistiinpanolla ei ole kenttää <i>content</i>, vastataan pyyntöön statuskoodilla <i>400 bad request</i>. </p>\n<p>Routejen tapahtumakäsittelijöissä tehtävää tarkastusta järkevämpi tapa tietokantaan talletettavan tiedon oikean muodon määrittelylle ja tarkastamiselle on Mongoosen <a href=\"https://mongoosejs.com/docs/validation.html\">validointitoiminnallisuuden</a> käyttö.</p>\n<p>Kullekin talletettavan datan kentälle voidaan määritellä validointisääntöjä skeemassa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> noteSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">mongoose<span class=\"token punctuation\">.</span>Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  content<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    type<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    minlength<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    required<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  date<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> </span><span class=\"gatsby-highlight-code-line\">    type<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    required<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span>  important<span class=\"token operator\">:</span> Boolean\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Kentän <i>content</i> pituuden vaaditaan nyt olevan vähintään 5 merkkiä. Kentälle <i>date</i> taas on asetettu ehdoksi että sillä on oltava joku arvo, eli kenttä ei voi olla tyhjä. Sama ehto on asetettu myös kentälle <i>content</i>, sillä minimipituuden tarkistava ehto ei huomioi tilannetta, missä kentällä ei ole mitään arvoa. Kentälle <i>important</i> ei ole asetettu mitään ehtoa, joten se on määritelty edelleen yksinkertaisemmassa muodossa.</p>\n<p>Esimerkissä käytetyt validaattorit <i>minlength</i> ja <i>required</i> ovat Mongooseen <a href=\"https://mongoosejs.com/docs/validation.html#built-in-validators\">sisäänrakennettuja</a> validointisääntöjä. Mongoosen <a href=\"https://mongoosejs.com/docs/validation.html#custom-validators\">custom validator</a> -ominaisuus mahdollistaa mielivaltaisten validaattorien toteuttamisen, jos valmiiden joukosta ei löydy tarkoitukseen sopivaa.</p>\n<p>Jos tietokantaan yritetään tallettaa validointisäännön rikkova olio, heittää tallennusoperaatio poikkeuksen. Muutetaan uuden muistiinpanon luomisesta huolehtivaa käsittelijää siten, että se välittää mahdollisen poikkeuksen virheenkäsittelijämiddlewaren huolehdittavaksi:  </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>body\n\n  <span class=\"token keyword\">const</span> note <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Note</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    content<span class=\"token operator\">:</span> body<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span>\n    important<span class=\"token operator\">:</span> body<span class=\"token punctuation\">.</span>important <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    date<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  note<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedNote</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>savedNote<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Laajennetaan virheenkäsittelijää huomioimaan validointivirheet:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">errorHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'CastError'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> <span class=\"token string\">'malformatted id'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'ValidationError'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> error<span class=\"token punctuation\">.</span>message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Validoinnin epäonnistuessa palautetaan validaattorin oletusarvoinen virheviesti:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/1e1c3/50.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMklEQVQoz5WRTVLEIBCFcxu3HtSN1/Awli7cjzOVTEJCQmj+uoFGGMeNv+VXD+p1VT8Wj26aJrnKYehPp+Px+DoMg/yCWCSBfHjUN3dwew8vh3mdRzC2AzDOemMcGG+ss877gJ/kAhKi0PTU03NP2oa2RLHTxi+HdTmpUTiLKaQS4jfysVAqhUvlfYdS7lJKhZlzrqea8it8jTdyzh3/FfiJFiYijJEoYnXNUPogxuhCMBgshoDoCT2GeocQrHV1uzOgdwsVZbQ1ddLobYrUokhgQXrYLlWCt+CMQa/3XUxTfaM7j0LtsKpNaS03tSpttjUmjrkkLrm0HvhiMjdVX6tSGlLm1raS/tyncSxiLnIpiyzzwlJetSnedhaClzquLGaeL6LY2o45FasLhf8VVj/oDYqIQesgbBKTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"50\"\n        title=\"50\"\n        src=\"/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/fcda8/50.png\"\n        srcset=\"/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/12f09/50.png 148w,\n/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/e4a3f/50.png 295w,\n/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/fcda8/50.png 590w,\n/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/efc66/50.png 885w,\n/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/c83ae/50.png 1180w,\n/fullstack/static/6beb35ed56d2e06e0eda3e36dea9f426/1e1c3/50.png 1670w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Promisejen ketjutus</h3>\n<p>Useat routejen tapahtumankäsittelijöistä muuttivat palautettavan datan oikeaan formaattiin kutsumalla palautetuille olioille niiden metodia <em>toJSON</em>. Esimimerkiksi uuden muistiinpanon luomisessa metodia kutsutaan <em>then</em>:in parametrina palauttamalle oliolle:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  note<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedNote</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>savedNote<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Voisimme tehdä saman myös hieman tyylikkäämmin <a href=\"https://javascript.info/promise-chaining\">promiseja ketjuttamalla</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  note\n    <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedNote</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> savedNote<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedAndFormattedNote</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>savedAndFormattedNote<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> </span>    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Eli ensimmäisen <em>then</em>:in takaisinkutsussa otamme Mongoosen palauttaman olion <em>savedNote</em> ja formatoimme sen. Operaation tulos palautetaan returnilla. Kuten osassa 2 <a href=\"/fullstack/osa2/palvelimella_olevan_datan_muokkaaminen#palvelimen-kanssa-tapahtuvan-kommunikoinnin-eristaminen-omaan-moduuliin\">todettiin</a>, promisen then-metodi palauttaa myös promisen. Eli kun palautamme <em>savedNote.toJSON()</em>:n takaisinkutsufunktiosta, syntyy promise, jonka arvona on formatoitu muistiinpano. Pääsemme käsiksi arvoon rekisteröimällä <em>then</em>-kutsulla uuden tapahtumankäsittelijän.</p>\n<p>Selviämme vieläkin tiiviimmällä koodilla käyttämällä nuolifunktion lyhempää muotoa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  note\n    <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedNote</span> <span class=\"token operator\">=></span> savedNote<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">savedAndFormattedNote</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>savedAndFormattedNote<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> \n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Esimerkkimme tapauksessa promisejen ketjutuksesta ei ole suurta hyötyä. Tilanne alkaa muuttua, jos joudumme tekemään useita peräkkäisiä asynkronisia operaatiota. Emme kuitenkaan mene asiaan sen tarkemmin. Tutustumme seuraavassa osassa Javascriptin <i>async/await</i>-syntaksiin, jota käyttämällä peräkkäisten asynkronisten operaatioiden tekeminen helpottuu oleellisesti.</p>\n<h3>Tietokantaa käyttävän version vieminen tuotantoon</h3>\n<p>Sovelluksen pitäisi toimia tuotannossa, eli Herokussa lähes sellaisenaan. Frontendin muutosten takia on tehtävä siitä uusi tuotantoversio ja kopioitava se backendiin. </p>\n<p>Huomaa, että vaikka määrittelimme sovelluskehitystä varten ympäristömuuttujille arvot tiedostossa <i>.env</i>, tietokantaurlin kertovan ympäristömuuttujan arvo asetetaan Herokuun komentorivillä komennolla <em>heroku config:set</em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">heroku config:set <span class=\"token assign-left variable\">MONGODB_URI</span><span class=\"token operator\">=</span>mongodb+srv://fullstack:secretpasswordhere@cluster0-ostce.mongodb.net/note-app?retryWrites<span class=\"token operator\">=</span>true</code></pre></div>\n<p>HUOM: jos komento antaa virheilmoituksen, anna MONGODB_URI:n arvo hipsuissa</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">heroku config:set <span class=\"token assign-left variable\">MONGODB_URI</span><span class=\"token operator\">=</span><span class=\"token string\">'mongodb+srv://fullstack:secretpasswordhere@cluster0-ostce.mongodb.net/note-app?retryWrites=true'</span></code></pre></div>\n<p>Sovelluksen pitäisi nyt toimia. Aina kaikki ei kuitenkaan mene suunnitelmien mukaan. Jos ongelmia ilmenee, <i>heroku logs</i> auttaa. Oma sovellukseni ei toiminut muutoksen jälkeen. Loki kertoi seuraavaa</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/73865480c799fbb73e1d47004e297d8a/29007/51a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABS0lEQVQY00VRiW6DMAx1KIQ2JHHCDUmBQMvYoWnd/v/fZpiqPVmRj2c/y4FoXWFZyKKXNXp8sW2Dt1c9hM9x/pnvj7B+D/OtzhVqXTccNUQR/MNfwXu4DuA83FcWZlhuWDTvtd/q69b4j3ZoMRcyQ61klp3P59MTwJyDtt2taWAK+yDnmVLKGGWNtjbTSiFKKW2e68ORUolMCJHBpesz5y99L527eE8mpkm3bVkUZVnSsng0VFWttaZMnufmyFAdEkRubIwYSXmy9oQYo4mF2KWsRdS7kFL7DERjDI3IDnGqAs6LXRZxHXjXsa6DsoKqAiGIV+TFwUbimQMkWxQFvX8rAA+BjxOfpnQK0XJj48hCYGh6Qtd3XV/XtT/QNK1zjpr3TRRdTwIzJjUNHYYjplUlqvJiLUs4XTVJEv5EmqZ7mPI4jslnjNFH/QJ6zB+EsvE00wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"51a\"\n        title=\"51a\"\n        src=\"/fullstack/static/73865480c799fbb73e1d47004e297d8a/fcda8/51a.png\"\n        srcset=\"/fullstack/static/73865480c799fbb73e1d47004e297d8a/12f09/51a.png 148w,\n/fullstack/static/73865480c799fbb73e1d47004e297d8a/e4a3f/51a.png 295w,\n/fullstack/static/73865480c799fbb73e1d47004e297d8a/fcda8/51a.png 590w,\n/fullstack/static/73865480c799fbb73e1d47004e297d8a/efc66/51a.png 885w,\n/fullstack/static/73865480c799fbb73e1d47004e297d8a/c83ae/51a.png 1180w,\n/fullstack/static/73865480c799fbb73e1d47004e297d8a/29007/51a.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>eli tietokannan osoite olikin jostain syystä määrittelemätön. Komento <i>heroku config</i> paljasti että olin vahingossa määritellyt ympäristömuuttujan <em>MONGO_URL</em> kun koodi oletti sen olevan nimeltään <em>MONGODB_URI</em>.</p>\n<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href=\"https://github.com/fullstack-hy2020/part3-notes-backend/tree/part3-6\">Githubissa</a>, branchissä <i>part3-6</i>.</p>\n</div>\n<div class=\"tasks\">\n<h3>Tehtävät 3.19.-3.21.</h3>\n<h4>3.19: puhelinluettelo ja tietokanta, step7</h4>\n<p>Toteuta sovelluksellesi validaatio, joka huolehtii, että backendiin ei voi lisätä nimeä, joka on jo puhelinluettelossa. Frontendin nykyisestä versiosta ei duplikaatteja voi luoda, mutta suoraan Postmanilla tai VS Coden REST-clientillä se onnistuu.</p>\n<p>Mongoose ei tarjoa tilanteeseen sopivaa valmista validaattoria. Käytä npm:llä asennettavaa pakettia\n<a href=\"https://github.com/blakehaswell/mongoose-unique-validator#readme\">mongoose-unique-validator</a>.</p>\n<p>Jos HTTP POST -pyyntö yrittää lisätä nimeä, joka on jo puhelinluettelossa, tulee vastata sopivalla statuskoodilla ja lisätä vastaukseen asianmukainen virheilmoitus.</p>\n<p><strong>Huom:</strong> unique-validatorin käyttö aiheuttaa konsoliin tulostuvan varoituksen</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(node:49251) DeprecationWarning: collection.ensureIndex is deprecated. Use createIndexes instead.\nconnected to MongoDB</code></pre></div>\n<p>Mongoosen <a href=\"https://mongoosejs.com/docs/deprecations.html\">dokumentaatio</a> kertoo, miten saat virheilmoituksen poistettua.</p>\n<h4>3.20*: puhelinluettelo ja tietokanta, step8</h4>\n<p>Laajenna validaatiota siten, että tietokantaan talletettavan nimen on oltava pituudeltaan vähintään 3 merkkiä ja puhelinnumeron vähintään 8 merkkiä. </p>\n<p>Laajenna sovelluksen frontendia siten, että se antaa jonkinlaisen virheilmoituksen validoinnin epäonnistuessa. Virheidenkäsittely hoidetaan lisäämällä <em>catch</em>-lohko uuden henkilön lisäämisen yhteyteen:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">personService\n    <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">createdPerson</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// pääset käsiksi palvelimen palauttamaan virheilmoitusolioon näin</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Voit näyttää frontendissa käyttäjälle Mongoosen validoinnin oletusarvoisen virheilmoituksen vaikka ne eivät olekaan luettavuudeltaan parhaat mahdolliset:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/fddf847e340f060549c3029f464a5493/f4fb1/56e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVQY05WPzQrCMBCE8/6PFGxSc+mlp1pQaSKt+espJfFQKCQxNUXRizp8LDPLwu4Cxuj5dNRKx6QQYlYymWd8U4jeRx/AiHEPoYBQISQRlgipVMu9IEQSogqUkLhUu0KuAykWqXOta15VYGwOomnGtp0oNZROGXaZGFvZIttqNl1nhiF50HM+SGnd7XHdx3lfBAQXxph5nv36hn99+wNAa22tdc4ty/Lv5jvurVA70P0r/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"56e\"\n        title=\"56e\"\n        src=\"/fullstack/static/fddf847e340f060549c3029f464a5493/fcda8/56e.png\"\n        srcset=\"/fullstack/static/fddf847e340f060549c3029f464a5493/12f09/56e.png 148w,\n/fullstack/static/fddf847e340f060549c3029f464a5493/e4a3f/56e.png 295w,\n/fullstack/static/fddf847e340f060549c3029f464a5493/fcda8/56e.png 590w,\n/fullstack/static/fddf847e340f060549c3029f464a5493/efc66/56e.png 885w,\n/fullstack/static/fddf847e340f060549c3029f464a5493/c83ae/56e.png 1180w,\n/fullstack/static/fddf847e340f060549c3029f464a5493/f4fb1/56e.png 1766w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>3.21 tietokantaa käyttävä versio internettiin</h4>\n<p>Generoi päivitetystä sovelluksesta \"full stack\"-versio, eli tee frontendista uusi production build ja kopioi se backendin repositorioon. Varmista että kaikki toimii paikallisesti käyttämällä koko sovellusta backendin osoitteesta <a href=\"http://localhost:3001\">http://localhost:3001</a>.</p>\n<p>Pushaa uusi versio Herokuun ja varmista, että kaikki toimii myös siellä.</p>\n</div>\n<div class=\"content\">\n<h3>Lint</h3>\n<p>Ennen osan lopetusta katsomme vielä nopeasti paitsioon jäänyttä tärkeää työkalua <a href=\"https://en.wikipedia.org/wiki/Lint_(software)\">lintiä</a>. Wikipedian sanoin:</p>\n<blockquote>\n<p><i>Generically, lint or a linter is any tool that detects and flags errors in programming languages, including stylistic errors. The term lint-like behavior is sometimes applied to the process of flagging suspicious language usage. Lint-like tools generally perform static analysis of source code.</i></p>\n</blockquote>\n<p>Staattisesti tyypitetyissä, käännettävissä kielissä esim. Javassa ohjelmointiympäristöt, kuten NetBeans osaavat huomautella monista koodiin liittyvistä asioista, sellaisistakin, jotka eivät ole välttämättä käännösvirheitä. Erilaisten <a href=\"https://en.wikipedia.org/wiki/Static_program_analysis\">staattisen analyysin</a> lisätyökalujen, kuten <a href=\"http://checkstyle.sourceforge.net/\">checkstylen</a> avulla voidaan vielä laajentaa Javassa huomautettavien asioiden määrää koskemaan koodin tyylillisiä seikkoja, esim. sisentämistä.</p>\n<p>Javascript-maailmassa tämän hetken johtava työkalu staattiseen analyysiin, eli \"linttaukseen\" on <a href=\"https://eslint.org/\">ESlint</a>.</p>\n<p>Asennetaan ESlint backendiin kehitysaikaiseksi riippuvuudeksi komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> eslint --save-dev</code></pre></div>\n<p>Tämän jälkeen voidaan muodostaa alustava ESlint-konfiguraatio komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node_modules/.bin/eslint --init</code></pre></div>\n<p>Vastaillaan kysymyksiin:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/ba1423527692484103dcb2b7374eeb01/dca52/52be.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVQY04WP4W6DIBRGL1Usimi2GlDpsMEJiJIss1nf/81G3db+3MkX8oVw4AKN6tWy9M51Ur938nKWou9fu44JUQpBmoZwjkoGlEKeo6KALIMHl3FYvffW+tkZZ2M11p6kTJoGYuLpqDEGGANCcDjc1wej1Z/bFkJwzq0haO9PbVtQWpZlXddZnkcNxWQZ2guk6VM2frp93dad7Xq1zn2EcDZGjiPnHMfH6xoRcs/xGK+AFD/lQccvL/M8W2vNNA1ax5lRHDVJ4F9EK5RSbxGlBqVeOCeUEowZY1VVsT8KWvy2ffPH/QYVuBgy5u5V2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"52be\"\n        title=\"52be\"\n        src=\"/fullstack/static/ba1423527692484103dcb2b7374eeb01/fcda8/52be.png\"\n        srcset=\"/fullstack/static/ba1423527692484103dcb2b7374eeb01/12f09/52be.png 148w,\n/fullstack/static/ba1423527692484103dcb2b7374eeb01/e4a3f/52be.png 295w,\n/fullstack/static/ba1423527692484103dcb2b7374eeb01/fcda8/52be.png 590w,\n/fullstack/static/ba1423527692484103dcb2b7374eeb01/efc66/52be.png 885w,\n/fullstack/static/ba1423527692484103dcb2b7374eeb01/c83ae/52be.png 1180w,\n/fullstack/static/ba1423527692484103dcb2b7374eeb01/dca52/52be.png 1550w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Konfiguraatiot tallentuvat tiedostoon <em>.eslintrc.js</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'env'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'commonjs'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'es6'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'node'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'extends'</span><span class=\"token operator\">:</span> <span class=\"token string\">'eslint:recommended'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'globals'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'Atomics'</span><span class=\"token operator\">:</span> <span class=\"token string\">'readonly'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'SharedArrayBuffer'</span><span class=\"token operator\">:</span> <span class=\"token string\">'readonly'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'parserOptions'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ecmaVersion'</span><span class=\"token operator\">:</span> <span class=\"token number\">2018</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'rules'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'indent'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token number\">4</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'linebreak-style'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'unix'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'quotes'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'single'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'semi'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'never'</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Muutetaan heti konfiguraatioista sisennystä määrittelevä sääntö, siten että sisennystaso on 2 välilyöntiä</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"indent\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">2</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Esim tiedoston <em>index.js</em> tarkastus tapahtuu komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node_modules/.bin/eslint index.js</code></pre></div>\n<p>Kannattaa ehkä tehdä linttaustakin varten <em>npm-skripti</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint .\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nyt komennot <em>npm run lint</em> suorittaa tarkastukset koko projektille.</p>\n<p>Myös hakemistossa <em>build</em> oleva frontendin tuotantoversio tulee näin tarkastettua. Sitä emme kuitenkaan halua, eli tehdään projektin juureen tiedosto <a href=\"https://eslint.org/docs/user-guide/configuring#ignoring-files-and-directories\">.eslintignore</a> ja sille seuraava sisältö</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">build</code></pre></div>\n<p>Näin koko hakemiston <em>build</em> sisältö jätetään huomioimatta linttauksessa.</p>\n<p>Lintillä on jonkin verran huomautettavaa koodistamme:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/d7ceb/53ea.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVQoz52SiW7DIBBETYIBc+1yGNeR0iZV//8bO8bpIdWqqo4sjCXezu6YQSk1/FvMVBLnnFNKWMs35S7vvRDiGE4Ui3e5k1BrrdZSu5gZFYlIa30Mz3BmBgOjuQt7rLs5SoAPIRybF6aKpzVYg6sdXpalbS90UYMPp9PpGG7eVWtKCBjuUsuakvfOf2iaJvSMUMEfwUpl7dlamswkRJBnMYi/pn2RqtGKISOCMeYsJazGcfw8ILqO4VXJmBgBW2v1JmWMAfwb89W2HjllIkbETIQWkBV34c9hXBR1zlln9w2ELB5XKw6Dt44pEpMLW1gxxv3OIC20YLpwepT4GmXXI7+8tHS7tevb69P1eZ7v95edhDNMwGNFOfA/p3gHIrcX2MhmVZYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"53ea\"\n        title=\"53ea\"\n        src=\"/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/fcda8/53ea.png\"\n        srcset=\"/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/12f09/53ea.png 148w,\n/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/e4a3f/53ea.png 295w,\n/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/fcda8/53ea.png 590w,\n/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/efc66/53ea.png 885w,\n/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/c83ae/53ea.png 1180w,\n/fullstack/static/cdf7d27db507f48c4ab9f7bd59f8071f/d7ceb/53ea.png 1446w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Ei kuitenkaan korjata ongelmia vielä.</p>\n<p>Parempi vaihtoehto kuin linttauksen suorittaminen komentoriviltä on konfiguroida editorille <i>eslint-plugin</i>, joka suorittaa linttausta koko ajan. Näin pääset korjaamaan pienet virheet välittömästi. Tietoja esim. Visual Studion ESlint-pluginsta <a href=\"https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint\">täällä</a>.</p>\n<p>VS Coden ESlint-plugin alleviivaa tyylisääntöjä rikkovat kohdat punaisella:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/17009/54a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVQY0z1P2Y6DMAzkQ8qVEEJCLshFQ4HCA62q1f7/56y3UjsaWfIxYzv7ee0uBOeCEEJK2ffc2UFK5UPY93uYrt4HqHPef9n3crQO6tm6bMe+/54Pa4N3UUuFMaa01T4IrYT1EDmjZVXVH+R5USPsYszist/m9HycznmlNOcc46al1GgR4jTPt2VZYUmMESLMGDNUVQVewgxZOp7X6wRNQtq2paQhpGNustNxmnQYo/UwdB2D1pdlWdYIGe+z476N4wgbGGOgJ+Qt74gKiSllrO44Ky6XosiLN0BZ5Dn8oEebpTRrM6zrBleBuAGAAaUNrhuEIKtxAx9WwBr9Kz8WCKE/zF8/JkfCXKkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"54a\"\n        title=\"54a\"\n        src=\"/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/fcda8/54a.png\"\n        srcset=\"/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/12f09/54a.png 148w,\n/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/e4a3f/54a.png 295w,\n/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/fcda8/54a.png 590w,\n/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/efc66/54a.png 885w,\n/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/c83ae/54a.png 1180w,\n/fullstack/static/64cf2fbae36000083aa1e48292aed8f2/17009/54a.png 1932w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Näin ongelmat on helppo korjata koodiin heti.</p>\n<p>ESlintille on määritelty suuri määrä <a href=\"https://eslint.org/docs/rules/\">sääntöjä</a>, joita on helppo ottaa käyttöön muokkaamalla tiedostoa <i>.eslintrc.js</i>.</p>\n<p>Otetaan käyttöön sääntö <a href=\"https://eslint.org/docs/rules/eqeqeq\">eqeqeq</a> joka varoittaa, jos koodissa yhtäsuuruutta verrataan muuten kuin käyttämällä kolmea = -merkkiä. Sääntö lisätään konfiguraatiotiedostoon kentän <i>rules</i> alle.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token string\">'rules'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n   <span class=\"token string\">'eqeqeq'</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tehdään samalla muutama muukin muutos tarkastettaviin sääntöihin.</p>\n<p>Estetään rivien lopussa olevat <a href=\"https://eslint.org/docs/rules/no-trailing-spaces\">turhat välilyönnit</a>, vaaditaan että <a href=\"https://eslint.org/docs/rules/object-curly-spacing\">aaltosulkeiden edessä/jälkeen on aina välilyönti</a> ja vaaditaan myös konsistenttia välilyöntien käyttöä <a href=\"https://eslint.org/docs/rules/arrow-spacing\">nuolifunktioiden parametrien suhteen</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token string\">'rules'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token string\">'eqeqeq'</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'no-trailing-spaces'</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'object-curly-spacing'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'always'</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'arrow-spacing'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'before'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'after'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Oletusarvoinen konfiguraatiomme ottaa käyttöön joukon valmiiksi määriteltyjä sääntöjä <i>eslint:recommended</i></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token string\">'extends'</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">'eslint:recommended'</span>,</code></pre></div>\n<p>Mukana on myös <em>console.log</em>-komennoista varoittava sääntö.\nYksittäisen sääntö on helppo kytkeä <a href=\"https://eslint.org/docs/user-guide/configuring#configuring-rules\">pois päältä</a> määrittelemällä sen \"arvoksi\" konfiguraatiossa 0. Tehdään toistaiseksi näin säännölle <i>no-console</i>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token string\">'rules'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token string\">'eqeqeq'</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'no-trailing-spaces'</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'object-curly-spacing'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'always'</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'arrow-spacing'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'before'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'after'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token string\">'no-console'</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>HUOM</strong> kun teet muutoksia tiedostoon <i>.eslintrc.js</i>, kannattaa muutosten jälkeen suorittaa linttaus komentoriviltä ja varmistaa että konfiguraatio ei ole viallinen:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/fullstack/static/683365a382c607616d65e603f8d8d39a/7575b/55.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAu0lEQVQY042QQRKDIAxFVRRRDGLaUREVrPe/Y792VduFbyCETH4SSExr23Uh7w31M3xgWyJTSinyvAD5AU4hRHKhY34yK1lUtap00zREDcEaY459QkSoCf1VXIG6Zn5wx8MwMPMZ+EKdpGl6FUspURJWlQoyTJjcB7MtyxpDXEEIfd+Lk1titPLeO+emCXbCGt1xs9biqdZ2+CzkZFn2R4yBY4zbts3zHCL6h4+D0P7ax2HUWqNKKctf7Rv0Vg9qGPdwFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"55\"\n        title=\"55\"\n        src=\"/fullstack/static/683365a382c607616d65e603f8d8d39a/fcda8/55.png\"\n        srcset=\"/fullstack/static/683365a382c607616d65e603f8d8d39a/12f09/55.png 148w,\n/fullstack/static/683365a382c607616d65e603f8d8d39a/e4a3f/55.png 295w,\n/fullstack/static/683365a382c607616d65e603f8d8d39a/fcda8/55.png 590w,\n/fullstack/static/683365a382c607616d65e603f8d8d39a/efc66/55.png 885w,\n/fullstack/static/683365a382c607616d65e603f8d8d39a/c83ae/55.png 1180w,\n/fullstack/static/683365a382c607616d65e603f8d8d39a/7575b/55.png 1608w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Jos konfiguraatiossa on jotain vikaa, voi editorin lint-plugin näyttää mitä sattuu.</p>\n<p>Monissa yrityksissä on tapana määritellä yrityksen laajuiset koodausstandardit ja näiden käyttöä valvova ESlint-konfiguraatio. Pyörää ei kannata välttämättä keksiä uudelleen ja voi olla hyvä idea ottaa omaan projektiin käyttöön joku jossain muualla hyväksi havaittu konfiguraatio. Viime aikoina monissa projekteissa on omaksuttu AirBnB:n <a href=\"https://github.com/airbnb/javascript\">Javascript</a>-tyyliohjeet ottamalla käyttöön firman määrittelemä <a href=\"https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb\">ESLint</a>-konfiguraatio.</p>\n<p>Sovelluksen tämän hetkinen koodi on kokonaisuudessaan <a href=\"https://github.com/fullstack-hy2020/part3-notes-backend/tree/part3-7\">Githubissa</a>, branchissa <i>part3-7</i>.</p>\n</div>\n<div class=\"tasks\">\n<h3>Tehtävä 3.22.</h3>\n<h4>3.22: lint-konfiguraatio</h4>\n<p>Ota sovellukseesi käyttöön ESlint, ja korjaa kaikki tyylivirheet.</p>\n<p>Tämä oli osan viimeinen tehtävä, joten on aika pushata koodi Githubiin sekä merkata tehdyt tehtävät <a href=\"https://studies.cs.helsinki.fi/stats/courses/fullstackopen\">palautussovellukseen</a>.</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/fullstack/static/8ac7bc0fb2b7018a7853b00c454b2103/part-3.svg"},"part":3,"letter":"d","lang":"fi"}}},"pageContext":{"part":3,"letter":"d","lang":"fi"}},"staticQueryHashes":["3128451518"]}